# API Документация - Проектные заявки

## Общая информация

### Базовый URL
```
https://your-domain.com/api/showcase/
```

### Аутентификация
API использует JWT токены для аутентификации. Токен передается в заголовке:
```
Authorization: Bearer <your-jwt-token>
```

### Форматы данных
- **JSON** - для большинства эндпоинтов
- **multipart/form-data** - для загрузки файлов

---

## Эндпоинты создания заявок

### 1. Создание заявки (авторизованные пользователи)

**POST** `/api/showcase/project-applications/`

Создание заявки авторизованным пользователем.

#### Заголовки
```
Authorization: Bearer <jwt-token>
Content-Type: application/json
```

#### Тело запроса

**Обязательные поля:**
```json
{
  "title": "Название проекта",
  "description": "Описание проекта",
  "company": "ООО Рога и Копыта"
}
```

#### Пример запроса
```json
{
  "title": "Система управления проектными заявками",
  "description": "Создание единой системы для подачи и обработки заявок на проекты",
  "company": "ООО Тестовая компания"
}
```

#### Успешный ответ (201)
```json
{
  "id": 1,
  "title": "Система управления проектными заявками",
  "description": "Создание единой системы для подачи и обработки заявок на проекты",
  "company": "ООО Тестовая компания",
  "creation_date": "2025-10-14T13:20:10.517307Z",
  "status": {
    "code": "created",
    "name": "Создана"
  },
  "author": {
    "id": 7,
    "email": "testuser@example.com",
    "full_name": "User Test"
  }
}
```

---

## Справочные эндпоинты

### 1. Статусы заявок

**GET** `/api/showcase/application-statuses/`

⚠️ **ВНИМАНИЕ**: Эндпоинт требует аутентификации (401 Unauthorized для неавторизованных пользователей).

#### Успешный ответ (200)
```json
[
  {
    "code": "created",
    "name": "Создана"
  },
  {
    "code": "work_department",
    "name": "Работа в отделе подразделения"
  },
  {
    "code": "approved_department",
    "name": "Одобрена подразделением"
  },
  {
    "code": "approved_with_changes_department",
    "name": "Одобрена подразделением (с изменениями)"
  },
  {
    "code": "returned_department",
    "name": "Возвращена на доработку подразделения"
  },
  {
    "code": "rejected_department",
    "name": "Отклонена подразделением"
  },
  {
    "code": "work_institute",
    "name": "Работа в отделе института"
  },
  {
    "code": "approved_institute",
    "name": "Одобрена институтом"
  },
  {
    "code": "approved_with_changes_institute",
    "name": "Одобрена институтом (с изменениями)"
  },
  {
    "code": "returned_institute",
    "name": "Возвращена на доработку института"
  },
  {
    "code": "rejected_institute",
    "name": "Отклонена институтом"
  },
  {
    "code": "work_cpds",
    "name": "Работа в отделе ЦПДС"
  },
  {
    "code": "approved_cpds",
    "name": "Одобрена ЦПДС"
  },
  {
    "code": "approved_with_changes_cpds",
    "name": "Одобрена с изменениями ЦПДС"
  },
  {
    "code": "returned_cpds",
    "name": "Возвращена на доработку ЦПДС"
  },
  {
    "code": "rejected_cpds",
    "name": "Отклонена ЦПДС"
  },
  {
    "code": "unknown",
    "name": "Не определен"
  }
]
```

### 2. Институты/Академии

**GET** `/api/showcase/institutes/`

⚠️ **ВНИМАНИЕ**: Эндпоинт требует аутентификации (401 Unauthorized для неавторизованных пользователей).

#### Успешный ответ (200)
```json
[
  {
    "code": "all",
    "name": "Всем"
  },
  {
    "code": "AVT",
    "name": "АВТ"
  },
  {
    "code": "AGA", 
    "name": "АГА"
  },
  {
    "code": "ADH",
    "name": "АДХ"
  },
  {
    "code": "VISH",
    "name": "ВИШ"
  },
  {
    "code": "IMTK",
    "name": "ИМТК"
  },
  {
    "code": "IPSS",
    "name": "ИПСС"
  },
  {
    "code": "ITTSY",
    "name": "ИТТСУ"
  },
  {
    "code": "IUCT",
    "name": "ИУЦТ"
  },
  {
    "code": "IEF",
    "name": "ИЭФ"
  },
  {
    "code": "YUI",
    "name": "ЮИ"
  }
]
```

### 3. Роли пользователей

**GET** `/api/showcase/user-roles/`

⚠️ **ВНИМАНИЕ**: Эндпоинт требует аутентификации (401 Unauthorized для неавторизованных пользователей).

#### Успешный ответ (200)
```json
[
  {
    "code": "employee",
    "name": "Работник/преподаватель РУТ (МИИТ)"
  },
  {
    "code": "company_representative", 
    "name": "Представитель компании"
  },
  {
    "code": "student",
    "name": "Студент РУТ (МИИТ)"
  },
  {
    "code": "other",
    "name": "Иное лицо"
  }
]
```

### 4. Подразделения/Кафедры

**GET** `/api/showcase/departments/`

#### Успешный ответ (200)
```json
[
  {
    "id": 1,
    "name": "Кафедра информационных технологий",
    "short_name": "КИТ"
  },
  {
    "id": 2,
    "name": "Кафедра математики",
    "short_name": "КМ"
  },
  {
    "id": 3,
    "name": "Кафедра физики",
    "short_name": "КФ"
  }
]
```

---

## Валидационные правила

### Обязательные поля

#### Обязательные поля:
- `title` - строка, максимум 255 символов
- `description` - текст, описание проекта
- `company` - строка, максимум 255 символов

### Типы данных

**status:**
- `created` - Создана
- `in_review` - На рассмотрении
- `approved` - Одобрена
- `rejected` - Отклонена

---

## Обработка ошибок

### 400 Bad Request
```json
{
  "email": ["Введите корректный email адрес."],
  "phone": ["Введите корректный номер телефона."],
  "user_role": ["Выберите корректную роль."]
}
```

### 401 Unauthorized
```json
{
  "detail": "Учетные данные не были предоставлены."
}
```

### 404 Not Found
```json
{
  "detail": "Не найдено."
}
```

### 500 Internal Server Error
```json
{
  "detail": "Внутренняя ошибка сервера."
}
```

---

## Загрузка файлов

### Поддержка multipart/form-data

Для полной формы заявки поддерживается загрузка файлов в поле "Дополнительные материалы":

#### Заголовки
```
Authorization: Bearer <jwt-token>
Content-Type: multipart/form-data
```

#### Тело запроса
```
additional_materials_file: [файл]
```

#### Допустимые форматы файлов
- PDF (.pdf)
- DOC/DOCX (.doc, .docx)
- XLS/XLSX (.xls, .xlsx)
- PPT/PPTX (.ppt, .pptx)
- Изображения (.jpg, .jpeg, .png, .gif)
- Архивы (.zip, .rar)

#### Максимальный размер файла
- 10 MB на файл
- 50 MB общий размер всех файлов

---

## Текущий статус реализации

### ✅ Работающие функции

1. **Упрощенная форма заявки** (`POST /api/showcase/project-applications/simple/`)
   - ✅ Создание заявок неавторизованными пользователями
   - ✅ Валидация всех обязательных полей
   - ✅ Автоматическое создание статуса "Создана"
   - ✅ Логирование изменений статуса
   - ✅ Корректный JSON ответ с полной информацией

2. **Полная форма заявки** (`POST /api/showcase/project-applications/`)
   - ✅ Создание заявок авторизованными пользователями
   - ✅ Все дополнительные поля (контекст, заинтересованные стороны, эксперты и т.д.)
   - ✅ Автоматическое создание статуса "Создана"
   - ✅ Логирование изменений статуса
   - ✅ Корректный JSON ответ с полной информацией

3. **База данных**
   - ✅ Модель `ProjectApplication` с полным набором полей
   - ✅ Связи с институтами, статусами, пользователями
   - ✅ Автоматическое заполнение описания из полей проблемы

4. **Аутентификация**
   - ✅ JWT токены работают корректно
   - ✅ Автоматическое заполнение автора заявки

### ⚠️ Проблемные функции

1. **Справочные эндпоинты**
   - ❌ Все справочники требуют аутентификации (401 Unauthorized)
   - ❌ Недоступны для неавторизованных пользователей
   - ❌ Требуют настройки разрешений

### 🔧 Требует доработки

1. **Настройка разрешений для справочников**
   - Открыть доступ к справочникам для неавторизованных пользователей
   - Настроить `permission_classes = [permissions.AllowAny]`

2. **Дополнительные функции**
   - Загрузка файлов (multipart/form-data)
   - Валидация email и телефона
   - Расширенная обработка ошибок

### 📊 Статистика тестирования

- **Упрощенные заявки**: 2 успешно созданы (ID: 59, 60)
- **Полные заявки**: 2 успешно созданы (ID: 61, 62)
- **Справочники**: 0 доступны без аутентификации
- **Аутентификация**: Работает корректно
